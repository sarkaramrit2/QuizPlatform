/* Js Functions of indexer admins 
 */

function addError(message) {
	$("#message")
			.html(
					'<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><h4>Error!</h4>'
							+ message + '</div>');
}

function addMessage(message) {
	$("#message")
			.html(
					'<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><h4>Info:</h4>'
							+ message + '</div>');
}

function addSuccessMessage(message) {
	$("#message")
			.html(
					'<div class="alert alert-success alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><h4>Success!</h4>'
							+ message + '</div>');
}

function createStatusTable(items) {
	$("#statusTable_wrapper").hide();
	if (items != null) {
		html = "<thead><tr><th>S. No.</th><th>Name</th><th>Consumer Count</th></tr></thead><tbody>";
		var itr = 1;
		for ( var m in items) {
			html += "<tr><td>" + itr + "</td><td>" + m + "</td><td>" + items[m]
					+ "</td></tr>"
			itr++;
		}
		html += "</tbody>";
		$("#statusTable").html(html);
		$("#statusTable_wrapper").show();
	}
}

function removeMessage() {
	$("#message").html('');
}

function register(consumerType, consumerCount, url, groupId) {
	var ajaxUrl = "/admin/indexerAdmin/register?consumerType=" + consumerType
			+ "&consumerCount=" + consumerCount + "&indexerURL=" + url + "&groupId=" + groupId;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function unregisterByType(consumerType, url, groupId) {
	var ajaxUrl = "/admin/indexerAdmin/unregisterByType?consumerType="
			+ consumerType + "&indexerURL=" + url + "&groupId=" + groupId;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function consumerStatus(consumerType, url, groupId) {
	var ajaxUrl = "/admin/indexerAdmin/showConsumerStatusByType?consumerType="
			+ consumerType + "&indexerURL=" + url + "&groupId=" + groupId;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			var items = data['items'];
			if (status == "success") {
				createStatusTable(items);
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function flush(consumerType, url) {
	var ajaxUrl = "/admin/indexerAdmin/flush?consumerType=" + consumerType
			+ "&indexerURL=" + url;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function reloadCache(url) {
	var ajaxUrl = "/admin/indexerAdmin/reloadCache?indexerURL=" + url;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function reloadMetadataCache(url) {
	var ajaxUrl = "/admin/indexerAdmin/reloadMetadataCache?indexerURL=" + url;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function index(consumerType, id, url) {
	var ajaxUrl = "/admin/indexerAdmin/index?consumerType=" + consumerType
			+ "&id=" + id + "&indexerURL=" + url;

	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function kafkaCurrentStatus(groupID, topic) {
	var ajaxUrl = "/admin/indexerAdmin/KafkaConsumerOffsetCurrentStatus?groupID=" + groupID
			+ "&topic=" + topic;
	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				//createKafkaStatusTable(data.items);
				//showDownloadableLink(data.items.link); // parse if json provided
				addSuccessMessage(msg);
			} else {
				addError("kafka Error!!");
			}
		}
	});
}

function kafkaLatestOffset(groupID, topic) {
	var ajaxUrl = "/admin/indexerAdmin/ResetKafkaConsumerOffsetToLatest?groupID=" + groupID
			+ "&topic=" + topic;
	$.ajax({
		url : ajaxUrl,
		type : "GET",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				//createKafkaStatusTable(data.items);
				//showDownloadableLink(data.items.link); // parse if json provided
				addSuccessMessage(msg);
			} else {
				addError("kafka Error!!");
			}
		}
	});
}

function showDownloadableLink(link) {
	$("#downloadableLink").html("To Download File : <a href='"+link+"' attr='download file' >click here</a>");
}

function createKafkaStatusTable(items) {
$("#offsetTable_wrapper").hide();
	if (items != null) {
		html = "<thead><tr><th>S. No.</th><th>Partition Id</th><th>Current Offset</th></tr></thead><tbody>";
		var itr = 1;
		for ( var m in items) {
			html += "<tr><td>" + itr + "</td><td>" + m + "</td><td>" + items[m]
					+ "</td></tr>"
			itr++;
		}
		html += "</tbody>";
		$("#offsetTable").html(html);
		$("#offsetTable_wrapper").show();
	}
}

function editConsumer(id) {
	var elementName = "#name-" + id;
	var elementUrl = "#url-" + id;
	var elementGroup = "#group-" + id;
	var elementEnabled = "#enabled-" + id;
	var elementEdit = "#edit-consumer-" + id;
	var elementDelete = "#delete-consumer-" + id;
	var elementSubmit = "#submit-consumer-" + id;

	$(elementName).removeAttr('disabled');
	$(elementUrl).removeAttr('disabled');
	$(elementGroup).removeAttr('disabled');
	$(elementEnabled).removeAttr('disabled');
	$(elementSubmit).removeAttr('hidden');
	$(elementEdit).attr('hidden', 'true');
	$(elementDelete).attr('hidden', 'true');
}

function cceditConsumer(id) {
	var elementName = "#cc-name-" + id;
	var elementQueueName = "#cc-queue-name-" + id;
	var elementQueueUrl = "#cc-queue-url-" + id;
	var elementQueueType = "#cc-queue-type-" + id;
	var elementEnabled = "#cc-enabled-" + id;
	var elementEdit = "#cc-edit-consumer-" + id;
	var elementSubmit = "#cc-submit-consumer-" + id;

	$(elementName).removeAttr('disabled');
	$(elementQueueName).removeAttr('disabled');
	$(elementQueueUrl).removeAttr('disabled');
	$(elementQueueType).removeAttr('disabled');
	$(elementEnabled).removeAttr('disabled');
	$(elementSubmit).removeAttr('hidden');
	$(elementEdit).attr('hidden', 'true');
}

function newConsumer() {
	var elementName = "#name-new";
	var elementUrl = "#url-new";
	var elementGroup = "#group-new";
	var elementEnabled = "#enabled-new";
	var elementNew = "#new-consumer";
	var elementSubmit = "#submit-consumer";

	$(elementName).removeAttr('disabled');
	$(elementUrl).removeAttr('disabled');
	$(elementGroup).removeAttr('disabled');
	$(elementEnabled).removeAttr('disabled');
	$(elementNew).attr('hidden', 'true');
	$(elementSubmit).removeAttr('hidden');
}

function ccnewConsumer() {
	var elementName = "#cc-name-new";
	var elementQueueName = "#cc-queue-name-new";
	var elementQueueUrl = "#cc-queue-url-new";
	var elementQueueType = "#cc-queue-type-new";
	var elementEnabled = "#cc-enabled-new";
	var elementNew = "#cc-new-consumer";
	var elementSubmit = "#cc-submit-consumer";

	$(elementName).removeAttr('disabled');
	$(elementQueueName).removeAttr('disabled');
	$(elementQueueUrl).removeAttr('disabled');
	$(elementQueueType).removeAttr('disabled');
	$(elementEnabled).removeAttr('disabled');
	$(elementNew).attr('hidden', 'true');
	$(elementSubmit).removeAttr('hidden');
}

function deleteConsumer(id) {
	alert("Are you sure?");
	var elementEdit = "#edit-consumer-" + id;
	var elementDelete = "#delete-consumer-" + id;
	$(elementEdit).attr('hidden', 'true');
	$(elementDelete).attr('hidden', 'true');
	var ajaxUrl = "/admin/indexerAdmin/deleteIC?id=" + id;

	$.ajax({
		url : ajaxUrl,
		type : "POST",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function submitConsumer(id) {
	var elementName = "#name-" + id;
	var elementUrl = "#url-" + id;
	var elementGroup = "#group-" + id;
	var elementEnabled = "#enabled-" + id;
	$(elementName).attr('disabled', 'true');
	$(elementUrl).attr('disabled', 'true');
	$(elementGroup).attr('disabled', 'true');
	$(elementEnabled).attr('disabled', 'true');
	var name = $(elementName).val();
	var url = $(elementUrl).val();
	var group = $(elementGroup).val();
	var enabled = $(elementEnabled).val();
	var ajaxUrl = "/admin/indexerAdmin/saveOrUpdateIC?id=" + id + "&name="
			+ name + "&url=" + url + "&group=" + group + "&enabled=" + enabled + "&action=u";

	$.ajax({
		url : ajaxUrl,
		type : "POST",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function ccsubmitConsumer(id) {
	var elementName = "#cc-name-" + id;
	var elementQueueName = "#cc-queue-name-" + id;
	var elementQueueUrl = "#cc-queue-url-" + id;
	var elementQueueType = "#cc-queue-type-" + id;
	var elementEnabled = "#cc-enabled-" + id;
	$(elementName).attr('disabled', 'true');
	$(elementQueueName).attr('disabled', 'true');
	$(elementQueueUrl).attr('disabled', 'true');
	$(elementQueueType).attr('disabled', 'true');
	$(elementEnabled).attr('disabled', 'true');
	var name = $(elementName).val();
	var queueName = $(elementQueueName).val();
	var queueUrl = $(elementQueueUrl).val();
	var queueType = $(elementQueueType).val();
	var enabled = $(elementEnabled).val();
	var ajaxUrl = "/admin/indexerAdmin/saveOrUpdateCC?id=" + id + "&name="
			+ name + "&queueUrl=" + queueUrl + "&queueType=" + queueType + "&enabled=" + enabled
			+ "&action=u&queueName=" + queueName;

	$.ajax({
		url : ajaxUrl,
		type : "POST",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function submitNewConsumer() {
	var elementName = "#name-new";
	var elementUrl = "#url-new";
	var elementEnabled = "#enabled-new";
	$(elementName).attr('disabled', 'true');
	$(elementUrl).attr('disabled', 'true');
	$(elementEnabled).attr('disabled', 'true');
	var name = $(elementName).val();
	var url = $(elementUrl).val();
	var enabled = $(elementEnabled).val();
	var ajaxUrl = "/admin/indexerAdmin/saveOrUpdateIC?name=" + name + "&url="
			+ url + "&enabled=" + enabled + "&action=s";

	$.ajax({
		url : ajaxUrl,
		type : "POST",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}

function ccsubmitNewConsumer() {
	var elementName = "#cc-name-new";
	var elementQueueName = "#cc-queue-name-new";
	var elementQueueUrl = "#cc-queue-url-new";
	var elementQueueType = "#cc-queue-type-new";
	var elementEnabled = "#cc-enabled-new";
	$(elementName).attr('disabled', 'true');
	$(elementQueueName).attr('disabled', 'true');
	$(elementQueueUrl).attr('disabled', 'true');
	$(elementQueueType).attr('disabled', 'true');
	$(elementEnabled).attr('disabled', 'true');
	var name = $(elementName).val();
	var queueName = $(elementQueueName).val();
	var queueUrl = $(elementQueueUrl).val();
	var queueType = $(elementQueueType).val();
	var enabled = $(elementEnabled).val();
	var ajaxUrl = "/admin/indexerAdmin/saveOrUpdateCC?name=" + name
			+ "&queueUrl=" + queueUrl + "&queueType=" + queueType + "&enabled=" + enabled
			+ "&action=s&queueName=" + queueName;

	$.ajax({
		url : ajaxUrl,
		type : "POST",
		dataType : 'json',
		success : function(data) {
			var status = data['status'];
			var msg = data['message'];
			if (status == "success") {
				addSuccessMessage(msg);
			} else {
				addError(msg);
			}
		}
	});
}
