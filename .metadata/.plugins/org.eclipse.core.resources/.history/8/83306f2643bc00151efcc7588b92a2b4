<%@ include file="/tld_includes.jsp"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<tiles:insertTemplate template="/views/layout/adminBaseTheme.jsp">
	<tiles:putAttribute name="title" value="Solr Admin" />
	<tiles:putAttribute name="head">
	</tiles:putAttribute>
	<tiles:putAttribute name="deferredScript">
		<script type="text/javascript"
			src="${path.js('jquery/jquery.dataTables.js')}"></script>
		<script type="text/javascript"
			src="${path.js('jquery/jquery.dataTables.columnFilter.js')}"></script>
		<script type="text/javascript">
		function reindex(id) {
			alert("Are you sure?");
			var ajaxUrl = "/admin/solr/reindexCategory?id=" + id;

			$.ajax({
				url : ajaxUrl,
				type : "GET",
				dataType : 'json',
				success : function(data) {
					var status = data['status'];
					var msg = data['message'];
					if (status == "success") {
						addSuccessMessage(msg);
					} else {
						addError(msg);
					}
				}
			});
		}			
		</script>
	</tiles:putAttribute>
	<tiles:putAttribute name="body">
		<div style="margin-left: 10px; margin-right: 10px;">
			<c:set var="title" value="Solr Admin" />
			<%@include file="brand.jsp"%>
			<div id="message"></div>
			<c:if test="${not empty message}">
				<div class="alert alert-danger alert-dismissable">
					<button type="button" class="close" data-dismiss="alert"
						aria-hidden="true">&times;</button>
					<h4>Error!</h4>
					${message}
				</div>
			</c:if>
			<div class="tabbable tabs-below">
				<ul class="nav nav-tabs">
					<li class="active"><a href="#tab1" data-toggle="tab">Shard
							Details</a></li>
					<li><a href="#tab2" data-toggle="tab">POG Info Admin
							(prod)</a></li>
					<li><a href="#tab3" data-toggle="tab">Indexer Logs Admin
							(prod)</a></li>
				</ul>
			</div>
			<div class="tab-content"
				style="height: 400px; padding: 10 px; margin-top: 10px">
				<div class="tab-pane active" id="tab1">
					<form method="get" class="form-horizontal"
						action="${path.http}/admin/solr/getCategoryCount"
						enctype="multipart/form-data">
						<div class="form-group">
							<label class="control-label col-lg-2">Select Server:</label>
							<div class="col-lg-3">
								<select id="node" name="nodeName" class="form-control">
									<option value="SolrCloud" selected="selected">SolrCloud</option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<div class="col-lg-3 col-lg-offset-2">
								<button class="btn btn-primary" type="submit"
									id="register-submit">Submit</button>
							</div>
						</div>
						<c:if test="${not empty allCount}">
							<div class="control-group">
								<label class="control-label">Total Count:</label>
								<div class="controls">
									<input type="text" value="${allCount}" disabled
										class="input-medium" />
								</div>
							</div>
						</c:if>
					</form>

					<c:if test="${not empty categoryCountDTOs}">
						<table cellpadding="0" cellspacing="0" border="0"
							class="display dataTable" id="servers">
							<thead>
								<tr>
									<th>S. No.</th>
									<th>Name</th>
									<th>Category Id</th>
									<th>Count</th>
									<th>Action</th>
								</tr>
							</thead>

							<tbody>
								<c:forEach items="${categoryCountDTOs}" var="dto"
									varStatus="ctr">
									<tr>
										<td>${ctr.index + 1}</td>
										<td>${dto.name}</td>
										<td>${dto.id}</td>
										<td>${dto.count}</td>
										<td><input type="button" value="Reindex"
											id="reindex-${dto.id}" onclick="reindex(${dto.id})">
										</td>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</c:if>
				</div>
				<div class="tab-pane" id="tab2">
					<form method="get" class="form-horizontal"
						action="${path.http}/admin/solr/getInfo"
						enctype="multipart/form-data">
						<div class="form-group info" style="background: none"
							id="dinputId">
							<label class="control-label col-lg-2">POG ID:<span
								class="required">*</span>
							</label>
							<div class="col-lg-3">
								<input name="id" class="form-control" id="did" type="text"
									value=<c:if test="${not empty pog}">${pog.getId()}</c:if>>
								<span id="didError" class="help-inline"></span>
							</div>
						</div>
						<div class="form-group">
							<div class="col-lg-3 col-lg-offset-2">
								<button class="btn btn-primary" type="submit" id="submit">Submit</button>
							</div>
						</div>
					</form>
					<br>
					<c:if test="${not empty pog}">
						<br>
						<div class="form-group" align="center">
							<div id="reindex" class="col-lg-3 col-lg-offset-2">
								<button class="btn btn-primary" type="submit"
									id="reindex-submit">Reindex it</button>
							</div>
						</div>
						<br>
						<br>
						<br>
						<table cellpadding="0" cellspacing="0" border="0"
							class="display dataTable" id="info">
							<thead>
								<tr>
									<th>S. No.</th>
									<th>Field Name</th>
									<th>Field Value</th>
								</tr>
							</thead>

							<tbody>
								<c:forEach items="${pog.getFieldNames()}" var="dto"
									varStatus="ctr">
									<tr>
										<td>${ctr.index + 1}</td>
										<td>${dto}</td>
										<td>${pog.getFieldValue(dto)}</td>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</c:if>
				</div>
			
				<div class="tab-pane" id="tab3">
					<form method="get" class="form-horizontal"
						action="${path.http}/admin/solr/IndexerLogs"
						enctype="multipart/form-data">
						<div class="form-group info" style="background: none"
							id="dinputId">
							<label class="control-label col-lg-2">POG ID:<span
								class="required">*</span>
							</label>
							<div class="col-lg-3">
								<input name="id" class="form-control" id="did" type="text"
									value=<c:if test="${not empty pog}">${pog.getId()}</c:if>>
								<span id="didError" class="help-inline"></span>
							</div>
						</div>
						<div class="form-group">
							<div class="col-lg-3 col-lg-offset-2">
								<button class="btn btn-primary" type="submit" id="submit">Submit</button>
							</div>
						</div>
					</form>
					<c:if test="${not empty grep_output}">
						<span class="required">Grep Results</span>
							${grep_output}
						</c:if>
					<br>
				</div>
				
				
		</div>
	</tiles:putAttribute>

</tiles:insertTemplate>
