var i = 1;
var selectedList = {};

var init = function() {
	for ( var index = 0; index < allFiltersList.length; index++) {
	    selectedList[allFiltersList[index].filterName] = false;
	}
	updateSelectedFilters('name0', 0);
	populateStaticFilterTable();
	populateExistingStaticFilters();
};

$("#add_row").click(
		function() {
			var rowFilterSelected = $('#name' + (i - 1)).val();
			if (rowFilterSelected == null || rowFilterSelected == undefined) {
				addError("Please select a filter for all the existing rows.");
				return;
			}
			$('#addr' + i).html(
					"<td>" + (i + 1) + "</td> <td><select id='name" + i
							+ "' class='form-control' ></select></td>");
			updateSelectedFilters('name' + i, i)

			$('#tab_logic').append('<tr id="addr' + (i + 1) + '"></tr>');
			i++;
		});

$("#delete_row").click(function() {
	if (i > 1) {
		$("#addr" + (i - 1)).html('');
		i--;
	}
});

$("#update_filter").click(function() {
	var filterNames = [];
	var filtersSelectedIndex = 0;
	for(var rowIndex = 0; rowIndex < i; rowIndex++) {
	   var rowFilterVal = $('#name' + (rowIndex)).val();
	   if(rowFilterVal != null || rowFilterVal != undefined) {
	   	filterNames[filtersSelectedIndex] = rowFilterVal ;
		filtersSelectedIndex++;
	   }
	}
	if(filterNames.length <= 0) {
		addError("Please select some filters.");
		return;
	}
	var ajaxUrl = '/admin/filter/static/add?filterNames[]=' + filterNames;
	$.ajax({
		url : ajaxUrl,
		type : "POST",
		dataType : 'json',
		success : function(data) {
			if(data.status == 'success') {
				staticFiltersList = data.items.staticFilters;
				populateStaticFilterTable();
				addSuccessMessage(data.message);
			} else {
				addError(data.message);
			}
		}
	});
});

var deleteRow = function(index) {
	var elemId = "delete_row" + index;
	if (i > 1) {
		$("#addr" + (index - 1)).html('');
		i--;
		console.log("Row deleted : " + index);
	}
};

var updateSelectedFilters = function(id, index) {
	for ( var rowIndex = index - 1; rowIndex >= 0; rowIndex--) {
		var rowFilterSelected = $('#name' + rowIndex).val();
		selectedList[rowFilterSelected] = true;
	}

	var optionList = $('#' + id);
	optionList.append('<option value="" disabled selected>Select Filter</option>');
	for (var filterName in selectedList) {
		//if (selectedList[filterName] == false) {
			var opt = new Option(filterName, filterName, false);
			optionList.append(opt);
		//}
	}
}

function populateStaticFilterTable() {
	$('#staticFilterTable').dataTable({
        "bPaginate": false,  
        "bInfo": false,  
        "bFilter": false,
        "bAutoWidth": false,
    	"bRetrieve":true,
        "aoColumns" : [
            { sWidth: '50px' },
            { sWidth: '100px' }
        ]
	}).fnClearTable();

	var tableContent = staticFiltersList;
	if (tableContent != null && tableContent.length > 0) {
		for ( var i = 0; i < (tableContent.length); i++) {
			$('#staticFilterTable')
				.dataTable()
				.fnAddData(
					[	tableContent[i].filterName,
						(i+1)
					]);
		}
	}
	$("#staticFilterTable").css("width","100%")
}

function populateExistingStaticFilters() {
	for(var idx = 0; idx < staticFiltersList.length; idx++) {
		var f = staticFiltersList[idx];
		$('#name'+idx).val(f.filterName);
		$("#add_row").click();
	}
}

init();